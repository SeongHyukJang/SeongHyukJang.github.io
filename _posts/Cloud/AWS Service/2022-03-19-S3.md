---
title:  "[AWS] S3 이해하기"

categories:
  - AWS Service
tags:
  - [S3]

toc: true
toc_sticky: true

date: 2022-03-19
last_modified_at: 2022-03-19
---

> ## 개념

&nbsp; Amazon S3는 Amazon에서 제공하는 대표적인 스토리지 서비스다. 뛰어난 내구성과 가용성을 가졌으며 다양한 용도로 활용이 가능하다.

> ## 관련 용어

### 1. 버킷 (Bucket)

&nbsp; 버킷이란, 데이터를 저장하는 저장소를 의미한다. 아래와 같은 특징이 있다.

- 저장할 수 있는 객체 수는 제한이 없다.
- 한 계정에 생성할 수 있는 버킷은 100개다. (AWS에 요청하여 증가시킬 수 있다)
- 버킷은 특정 Region에 소속되며, 한번 선택하면 변경할 수 없다.

### 2. 객체 (Object)

&nbsp; 객체란, 버킷에 저장되는 기본 개체를 의미한다. 아래와 같은 특징이 있다.

- 객체의 최대 크기는 5TB다.
- 음성, 비디오, 텍스트 등 모든 데이터는 버킷에 저장될 때 객체로 구성되며, 메타데이터와 함께 저장된다.
- S3는 Key-Value 형식으로 저장된다. Key는 객체의 이름이고 Value는 객체의 내용이다.
- 각 개체마다 고유한 URL을 가지고 있다. (https://버킷이름.s3.지역코드.amazonaws.com/"객체 이름")

### 3. 액세스 제어 목록 (ACL)

&nbsp; 액세스 제어 목록 (Access Control List)은 버킷 내의 객체들이 어떤 계정에서 소유하고 있는지, 쓰기 및 읽기 권한이 있는지와 같은 정보를 나타내는 목록이다.

- ACL을 사용한다면, 동일한 버킷 내의 객체들이 서로 다른 소유자가 존재할 수 있다. 즉, 특정 객체는 버킷 생성 계정이 아닌 다른 계정이 소유해야 한다면 ACL을 사용해야 한다.
- 객체에 대한 접근 권한을 ACL로 사용하지 않고 IAM 정책, S3 버킷 정책, VPC Endpoint 정책을 사용하는 것이 유지 관리하기 쉽다. 즉 AWS는 ACL을 사용하지 않는 것을 권장한다.

### 4. S3 액세스 포인트

&nbsp; 버킷 정책처럼 버킷 안의 객체에 대한 권한을 설정할 수 있다. 버킷 정책과 차이점은 정책을 여러개를 생성할 수 있다. 즉, 버킷에 대한 대규모 액세스를 간단하게 관리할 수 있게 해주는 서비스다.

- 만약 버킷안에 객체가 많아지면 버킷 정책 하나에 모든 객체에 대한 정책을 설정해야 한다. 즉, 버킷 정책은 점점 거대해 지고 관리하기 어려워진다. 이런 경우에 S3 액세스 포인트를 사용한다면 관리를 효율적으로 할 수 있다.

> ## 특징

### S3 버킷 버전 관리

- S3 버킷에 대한 버전 관리를 할 수 있다. 즉, 버킷 안에 저장되는 모든 객체들의 버전을 관리할 수 있으며, 의도치 않은 데이터 손실이나 변형에 대해 보호할 수 있다.
- Default로는 비활성화 되어 있기 때문에, 사용하려면 활성화 시켜야 한다. 또한, 한번 활성화된 버킷은 일시적으로 비활성화할 수는 있지만 해제할 수는 없다.
- 2차 인증으로 MFA를 추가할 수 있으며, 오직 루트 계정으로만 가능하다.
- 한 객체에 대해 버전이 3개가 존재한다면, 객체 3개에 대한 요금이 부과된다.
- S3 수명 주기와 함께 사용하여 스토리지 비용을 관리할 수 있다.
- 버전 관리 활성화는 버킷에 권한을 가진 모든 사용자가 가능하다.

### S3 버킷 정책 설정

- 버킷을 Private으로 사용하기 위해 버킷 정책을 설정하여 보안성을 강화할 수 있다.
- 정책을 설정하는 언어는 JSON이며, 버킷 내의 객체에 대한 접근을 허용하거나 거부할 수 있다.
- 정책을 작성할 때, 와일드카드를 문자를 활용할 수 있다. (* . ? + 등)
- 버킷에 있는 모든 객체에 접근할 수 있게 하는 정책은 다음과 같다.

```
{
    "Version" : "2012-10-17",
    "Statement" : [
        {
            "Effect": "Allow",
			"Principal": "*",
			"Action": "*",
			"Resource": "arn:aws:s3:::"버킷 이름"/*"
        }
    ]
}
```

### S3가 지원하는 일관성 모델

&nbsp; S3는 분산 객체 스토리지다. 즉 가용성을 위해 객체를 분산하여 저장하기 때문에, 전파되는 시간이 필요하다. 결국, 지연 시간 없이 데이터에 대한 일관성을 유지할 수 없다. 그래서 S3는 절충안으로 2가지 일관성 모델을 사용한다.

1. 최종 일관성 (eventual consistency)
- 일시적으로 데이터에 대한 일관성이 없을 수 있지만, 최종적으로는 일광성이 유지된다는 것이다.
- 적용되는 HTTP 메소드 : 덮어쓰기 PUT, DELETE

2. 쓰기 후 읽기 일관성 (read-after-write consistency)
- 객체를 쓰고 읽은 후에 일관성을 유지할 수 있다. 즉, 쓰기 후 읽기를 하지 못하면 객체를 반환하지 않는다.
- 적용되는 HTTP 메소드 : 새 객체 PUT, UPDATE

### 멀티파트 업로드

&nbsp; 만약 업로드하는 객체의 크기가 100MB가 넘어가면 멀티파트 업로드를 사용하는 것을 AWS에서 권장한다. 멀티파트 업로드를 사용하면 객체를 여러 파트로 나눈 후, 독립적으로 업로드가 진행된다. 모든 파트가 업로드 되면 S3가 수집하여 하나의 객체로 만든다.
<br><br>
다음과 같은 상황에 멀티파트 업로드를 사용하는 것이 좋다.
- 안정적이고 높은 대역폭 네트워크가 있을 때, 멀티파트 업로드를 사용하면 멀티 스레드 성능을 사용하여 고성능 네트워크 활용을 극대화할 수 있다.
- 불안정한 네트워크에서 객체를 업로드 해야할 때 멀티파트 업로드를 사용하면 오류가 난 파트만 다시 업로드가 가능하기 때문에 복원력이 강화된다.

### 버킷 접근 방식

&nbsp; 버킷에 URL로 접근할 수 있는 방법은 2가지가 존재한다. 가상 호스팅 방식과 경로 방식이다. 하지만 경로 방식은 더 이상 사용되지 않기 떄문에 현재는 가상 호스팅 방식만 사용이 가능하다.

- 가상 호스팅 방식 : https://버킷이름.s3.지역코드.amazonaws.com
- 경로 방식 : https://s3.지역코드.amazonaws.com/버킷이름

※ 참고자료 : [Amazon S3 Path Deprecation Plan - The Rest of the Story](https://aws.amazon.com/ko/blogs/aws/amazon-s3-path-deprecation-plan-the-rest-of-the-story/)

### 정적 웹 사이트 호스팅

&nbsp; 버킷을 사용하여 정적 웹 사이트를 호스팅할 수 있다. 정적 콘텐츠만 사용이 가능하며, PHP나 JSP와 같이 스크립트 파일을 지원하지 않는다.
<br><br>
웹 사이트 엔드 포인트는 다음 두 형식 중 하나를 따른다.
- 대시 리전(-) : http://버킷이름.s3-website-지역코드.amazonaws.com
- 점 리전(.) : http://버킷이름.s3-website.지역코드.amazonaws.com

※ 웹 사이트 엔드 포인트는 HTTPS를 지원하지 않는다. 만약 보안이 필요하다면, CloudFront를 통해서 정적 웹 사이트를 제공해야 한다.

> ## 종류

&nbsp; Amazon은 사용 용도에 따라 여러가지 종류를 제공하지만, 주로 사용하는 S3는 4가지가 있다.

### 1. S3 Standard

&nbsp; 일반적으로 사용하는 S3다. 범용적으로 사용되며, 주로 S3에 자주 액세스 해야할 때 사용한다.
- 내구성 : 99.999999999%
- 가용성 : 99.99%

### 2. S3-IA

&nbsp; S3 Standard-Infrequent Access라고도하며, 자주 액세스하지 않지만, 액세스할 때는 빠른 속도가 필요할 때 사용한다. 즉 S3보다 성능면에서 뛰어나다.
- 내구성 : 99.999999999%
- 가용성 : 99.9%

### 3. S3 One Zone-IA

&nbsp; S3-IA와 성능은 동일하지만 사용하는 가용 영역의 개수가 다르다. S3-IA는 최소 3개를 사용하지만 S3 One Zone-IA는 한 개만 사용하여 비교적으로 저렴하게 이용하기 위해 사용한다.
- 내구성 : 99.999999999%
- 가용성 : 99.5%

### 4. S3 Glacier
&nbsp; S3 Glacier는 아카이브용으로 만들어졌다. 즉, 자주 액세스하지 않고 오랫동안 보관하기 위해 사용한다. 주로 백업용으로 많이 사용한다.
- 내구성 : 99.999999999%
- 가용성 : 99.9%